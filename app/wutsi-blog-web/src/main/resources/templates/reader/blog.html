<!DOCTYPE HTML>
<html th:lang="${page.language}" xmlns="http://www.w3.org/1999/html" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="~{components/layout :: head}"></div>
</head>

<body class="paper">

<div th:replace="~{components/layout :: navbar-blog(${blog}, ${blog.slug})}"></div>
<div th:replace="~{components/layout :: tabs(${blog}, 'blog')}"></div>

<div class="container margin-top">
    <div class="row margin-bottom" th:if="${blog.blog} AND (${blog.id} == ${user?.id} OR ${superUser})">
        <div th:replace="~{components/kpi :: blog-overview(${blog}, ${wallet})}"></div>
    </div>

    <div class="row">
        <div class="content-main col-12 col-lg-6 offset-lg-1" th:if="${stories}">
            <div class="margin-bottom-small" th:each="story,it: ${stories}">
                <div class="d-block d-lg-none" id="shop-panel"
                     th:if="${it.index} == 1 AND ${products}">
                    <div th:replace="~{components/product :: shop-panel(${products})}"></div>
                </div>

                <div class="border border-rounded margin-bottom-small text-center"
                     th:if="${it.index} == 3 AND (!${user} OR ${user.canSubscribeTo(blog)})">
                    <div th:replace="~{components/follow :: panel(${blog}, ${blog.slug}, null, 'blog')}"></div>
                </div>

                <div class="border border-rounded margin-bottom-small text-center"
                     th:if="${it.index} == 5 AND ${toggles.monetization} AND ${blog.donationUrl}">
                    <div th:replace="~{components/donate :: panel(${blog})}"></div>
                </div>

                <div th:replace="~{components/story :: story-card(${story}, true)}"></div>
            </div>
            <div th:if="${moreUrl}">
                <div th:replace="~{components/story :: load-more(${moreUrl})}"></div>
            </div>
        </div>

        <div th:class="${stories} ? 'col-lg-4 d-none d-lg-block' : 'col-12 col-lg-6 offset-lg-3'">

            <div class="text-center margin-top-2x margin-bottom-2x" th:if="${showCreateStoryButton}">
                <a class="btn btn-primary" href="/editor" id="btn-create-story" th:text="#{button.create_first_story}">
                    Write your first Story
                </a>
                <a class="btn btn-light margin-left" href="/me/syndicate" id="btn-import-story"
                   th:text="#{button.syndicate_story}">
                    Import
                </a>
            </div>

            <div class="content-sidebar border border-rounded padding text-center">
                <img class="author-picture" height="64" th:alt="${blog.fullName}"
                     th:if="${blog.pictureSmallUrl}" th:src="${blog.pictureSmallUrl}" width="64"/>
                <h4 class="margin-none">
                    <span th:text="${blog.fullName}">Ray Sponsible</span>
                    <span th:replace="~{components/author :: author-wpp-badge(${blog})}"></span>
                </h4>
                <span th:replace="~{components/author :: author-meta(${blog}, true)}"></span>
                <div class="margin-top" th:if="${blog.biography}" th:text="${blog.biography}">Biography</div>
                <div class="margin-top flex flex-center">
                    <div
                        th:replace="~{components/follow :: follow-button(${blog}, ${blog.slug}, true, true, null, 'blog')}"></div>

                    <div class="margin-left" th:if="${toggles.monetization} AND ${blog.donationUrl}">
                        <div th:replace="~{components/donate :: button(${blog})}"></div>
                    </div>

                    <div class="btn-icon margin-left">
                        <div th:replace="~{components/share :: widget-alt(${blog.name}, ${blog.url})}"></div>
                    </div>
                </div>
            </div>

            <div class="margin-top" id="shop-panel-sidebar" th:if="${products}">
                <div th:replace="~{components/product :: shop-panel(${products})}"></div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{components/google :: one-tap(null, null)}"></div>
<div th:replace="~{components/share :: popup}"></div>
<div th:replace="~{components/layout :: footer}"></div>

<script>
    $(document).ready(function () {
        /* Track subscription click */
        $('.btn-follow').click(function () {
            wutsi.ga_track('blog', 'subscribe');
        });
    });

</script>
</body>
</html>
